# Server block for file serving (unchanged)
server {
    listen 80;
    server_name shared.animez.my.id;

    root /shared;
    index index.html;

    autoindex on;
    autoindex_exact_size on;
    autoindex_localtime on;

    # Enable support for partial downloads (resume support)
    add_header Accept-Ranges bytes;

    # Disable buffering for faster data send
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;

    # Increase buffer and timeout limits
    client_max_body_size 0;
    client_body_timeout 60s;
    keepalive_timeout 65;
    send_timeout 60s;

    # Enable larger file reads
    aio threads;
    output_buffers 1 512k;

    # Gzip off for pure file transfer speed
    gzip off;

    location / {
        try_files $uri $uri/ =404;
        add_header Cache-Control no-cache;
    }
}

# Server block for reverse proxy with DYNAMIC PATH SUPPORT
server {
    listen 81;
    server_name oppa.animez.my.id;  # Different server name

    location / {
        proxy_pass https://oppa.biz;  # Note: NO trailing slash
        
        # Essential headers
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;
        
        # Handle redirections properly - this handles dynamic paths
        proxy_redirect https://oppa.biz/ http://$host/;
        proxy_redirect https://oppa.biz http://$host;
        
        # Timeouts
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
        
        # Buffer settings
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
        
        # Enable SSL verification (recommended)
        #proxy_ssl_verify on;
        #proxy_ssl_trusted_certificate /etc/ssl/certs/ca-certificates.crt;
        #proxy_ssl_verify_depth 2;
    }
}